var Te=Object.defineProperty;var w=(R,y)=>Te(R,"name",{value:y,configurable:!0});(()=>{"use strict";var R={};class y{static build(e,t,s){y.validateRoute(s);const o=y.getParameter("route"),r=document.querySelector("div#app");r.innerHTML=e.trim(),t.forEach(n=>{const l=`${n.name.toLowerCase().split("component")[0]}-component`;r.querySelector(l).getAttribute("route")===o&&customElements.define(l,n)})}static getParameter(e){return new URLSearchParams(window.location.search).get(e)}static validateRoute(e){const t=y.getParameter("route");t===null||t==="404"||e.includes(t)===!1&&window.location.replace("?route=404")}}w(y,"AppService");var se='<index-component></index-component> <configuration-component route="config"></configuration-component> <dart-component route="501"></dart-component> <pagenotfound-component route="404"></pagenotfound-component>';const ce=se;class S{static build(e,t){e.innerHTML=t,S.updateStaticClickEvents(e,t)}static updateStaticClickEvents(e,t){e.querySelectorAll("[static]").forEach(o=>{const r=o.getAttribute("static"),n=e.constructor[r];n!==void 0&&o.addEventListener("click",()=>{n(),S.build(e,t)})})}}w(S,"AppComponentService");var ae="<h1>#404 - Page Not Found Exception</h1>";const ie=ae;class z extends HTMLElement{connectedCallback(){S.build(this,ie)}}w(z,"PageNotFoundComponent");var de='<h3>AppSwitch</h3> <button static="openConfig">Create Dart Game</button>';const le=de;class U extends HTMLElement{connectedCallback(){S.build(this,le)}static openConfig(){window.location="?route=config"}}w(U,"IndexComponent");class A{static throwErrorIfUndefined(e){if(e===void 0)throw new Error("PropertyGuardError: parameter is undefined")}static throwErrorIfNoString(e){if(typeof e!="string")throw new Error("PropertyGuardError: parameter is not a string")}static throwErrorIfNoArrayOfStrings(e){e.forEach(t=>{try{this.throwErrorIfNoString(t)}catch{throw new Error("PropertyGuardError: parameter is not an array of strings")}})}static throwErrorIfNoNumber(e){if(typeof e!="number")throw new Error("PropertyGuardError: parameter is not a number")}static throwErrorIfNoArrayOfNumbers(e){e.forEach(t=>{try{this.throwErrorIfNoNumber(t)}catch{throw new Error("PropertyGuardError: parameter is not an array of numbers")}})}static throwErrorIfNoBoolean(e){if(typeof e!="boolean")throw new Error("PropertyGuardError: parameter is not a boolean")}static throwErrorIfNoArrayOfBooleans(e){e.forEach(t=>{try{this.throwErrorIfNoBoolean(t)}catch{throw new Error("PropertyGuardError: parameter is not an array of booleans")}})}static throwErrorIfNoArray(e){if(Array.isArray(e)===!1)throw new Error("PropertyGuardError: parameter is not an array")}static throwErrorIfNoObject(e){if(typeof e!="object")throw new Error("PropertyGuardError: parameter is not an object")}static throwErrorIfNoArrayOfObjects(e){e.forEach(t=>{try{this.throwErrorIfNoObject(t)}catch{throw new Error("PropertyGuardError: parameter is not an array of objects")}})}static throwErrorIfItemIsNotInArray(e,t){if(this.throwErrorIfUndefined(e),this.throwErrorIfNoArray(t),t.includes(e)===!1)throw new Error("PropertyGuardError: item is not part of the array")}}w(A,"PropertyGuardService");class v{static Serialize(e,t){A.throwErrorIfNoObject(t),A.throwErrorIfNoString(e);const s=JSON.stringify(t);localStorage.setItem(e,s)}static Deserialize(e){A.throwErrorIfNoString(e);const t=localStorage.getItem(e);if(t!==null)return JSON.parse(t)}}w(v,"JsonSerializationService");var ue='<h3>Game Configuration</h3> <label><h5>Number of Players</h5></label> <select id="numberOfPlayers" required> <option value="1">1 Player</option> <option value="2" selected="selected">2 Players</option> <option value="3">3 Players</option> <option value="4">4 Players</option> <option value="5">5 Players</option> <option value="6">6 Players</option> </select> <br> <br> <label><h5>Player Names</h5></label> <input id="player1" type="text" placeholder="Player 1" value="Player 1"> <input id="player2" type="text" placeholder="Player 2" value="Player 2"> <input id="player3" type="text" placeholder="Player 3" value="Player 3" hidden> <input id="player4" type="text" placeholder="Player 4" value="Player 4" hidden> <input id="player5" type="text" placeholder="Player 5" value="Player 5" hidden> <input id="player6" type="text" placeholder="Player 6" value="Player 6" hidden> <button static="createGame">Game On</button>';const he=ue,E={legStatus:{new:"new",ongoing:"ongoing",closed:"closed"}};class C{static rotate(e,t,s){const o=JSON.parse(JSON.stringify(e)),r=t+s;for(let n=0;n<r;n+=1)o.push(o.shift());return o}}w(C,"PlayerNameRotationService");class u{static create(e,t){A.throwErrorIfNoString(e),A.throwErrorIfNoArrayOfStrings(t);const s=new Date,r=`${s.toLocaleString("en-US",{month:"long"})} ${s.getDate()}, ${s.getFullYear()}`,n=`${s.toISOString().split("T")[0]}.json`,i={},l={},c={},a={},m={},b={},I={},F={},d={},g={},x={};return t.forEach(f=>{l[f]=0,a[f]=0,c[f]=501,m[f]=[],i[f]=[],b[f]="-",I[f]="-",F[f]="-",d[f]="-",g[f]="-",x[f]="-"}),{date:r,dateFileName:n,id:e,legScores:i,legs:l,players:t,required:c,scores:m,sets:a,highestScore:b,highestFinish:I,mostFrequentScore:F,gameAverage:d,legAverage:g,bestLegAverage:x}}static getNextPlayer(e){if(u.getStatus(e)===E.legStatus.closed)return;let s=0,o=0;e.players.forEach(l=>{const c=e.sets[l],a=e.legs[l];s+=c,o+=a});const r=C.rotate(e.players,s,o);let n=r[0],i=e.legScores[n].length;if(i===0)return n;for(let l=1;l<r.length;l+=1){const c=r[l],a=e.legScores[c].length;a<i&&(n=c,i=a)}return n}static getStatus(e){const{legScores:t,players:s,required:o}=e;let r=!1,n=!1;return s.forEach(i=>{t[i].length>0&&(r=!0),o[i]===0&&(n=!0)}),r===!1?E.legStatus.new:n?E.legStatus.closed:E.legStatus.ongoing}static closeLeg(e){if(u.getStatus(e)!==E.legStatus.closed)throw Error("cannot finish unfinished leg");let s;if(e.players.forEach(n=>{const i=Number.parseFloat(e.legAverage[n]);e.bestLegAverage[n]==="-"&&(e.bestLegAverage[n]=i.toFixed(2));const l=Number.parseFloat(e.bestLegAverage[n]);if(i>l&&(e.bestLegAverage[n]=i.toFixed(2)),e.required[n]===0){s=n;const a=e.legScores[n],{length:m}=a,b=a[m-1];(e.highestFinish[n]==="-"||e.highestFinish[n]<b)&&(e.highestFinish[n]=b)}e.legScores[n].forEach(a=>{e.scores[n].push(a)}),e.legScores[n]=[],e.required[n]=501}),s===void 0)throw Error("winner === undefined!!!");const o=e.legs[s];(o===0||o===1)&&(e.legs[s]+=1),o===2&&(e.sets[s]+=1,e.players.forEach(n=>{e.legs[n]=0}));let r=e;return r=u.updateLegAverage(r),r}static submitScore(e,t){if(A.throwErrorIfNoNumber(t),u.getStatus(e)===E.legStatus.closed)throw new Error("cannot submit score on finished leg");if(t<0||t>180)throw new Error("invalid score");if([163,166,169,172,173,175,176,178,179].includes(t))throw new Error("impossible score");const r=u.getNextPlayer(e),n=e.required[r];if(t>n)throw new Error(`invalid score '${t}' for player '${r}' while required is '${n}'`);e.legScores[r].push(t),e.required[r]=n-t;let i=0,l=0;e.legScores[r].forEach(m=>{i+=m,l+=1});const c=Number.parseFloat(i/l).toFixed(2);e.legAverage[r]=c;let a=e;return a=u.updateHighestScore(a),a=u.updateLegAverage(a),a=u.updateGameAverage(a),a=u.updateMostFrequentScore(a),a}static getWinner(e){if(u.getStatus(e)!==E.legStatus.closed)throw new Error("cannot get winner if leg is not closed");let s;return e.players.forEach(o=>{e.required[o]===0&&(s=o)}),s}static undoScore(e){if(u.getStatus(e)===E.legStatus.new)throw new Error("cannot undo score on new leg");let s=0,o=0;e.players.forEach(a=>{const m=e.sets[a],b=e.legs[a];s+=m,o+=b});const r=C.rotate(e.players,s,o);let n=r[0],i=e.legScores[n].length;for(let a=1;a<r.length;a+=1){const m=r[a],b=e.legScores[m].length;b>=i&&(n=m,i=b)}const l=e.legScores[n].pop();e.required[n]+=l;let c=e;return c=u.updateHighestScore(c),c=u.updateLegAverage(c),c=u.updateGameAverage(c),c=u.updateMostFrequentScore(c),c}static updateHighestScore(e){return e.players.forEach(t=>{const s=e.scores[t],o=e.legScores[t];if(s.length===0&&o.length===0){e.highestScore[t]="-";return}let r=0;e.scores[t].forEach(n=>{n>r&&(r=n)}),e.legScores[t].forEach(n=>{n>r&&(r=n)}),r>0&&(e.highestScore[t]=r)}),e}static updateLegAverage(e){return e.players.forEach(t=>{const s=e.legScores[t];if(s.length===0)e.legAverage[t]="-";else{let o=0;s.forEach(n=>{o+=n});const r=Number.parseFloat(o/s.length).toFixed(2);e.legAverage[t]=r}}),e}static updateGameAverage(e){return e.players.forEach(t=>{const s=e.scores[t],o=e.legScores[t];if(s.length===0&&o.length===0){e.gameAverage[t]="-";return}let r=0;s.forEach(l=>{r+=l}),o.forEach(l=>{r+=l});const n=s.length+o.length,i=Number.parseFloat(r/n).toFixed(2);e.gameAverage[t]=i}),e}static getScoreDistribution(e,t){A.throwErrorIfNoObject(e),A.throwErrorIfNoString(t);const s=e.scores[t].concat(e.legScores[t]),o={};return s.forEach(r=>{o[r]===void 0?o[r]=1:o[r]+=1}),o}static updateMostFrequentScore(e){return e.players.forEach(t=>{const s=u.getScoreDistribution(e,t);if(Object.keys(s).length===0){e.mostFrequentScore[t]="-";return}let o="-",r=-1;Object.keys(s).forEach(n=>{const i=s[n];i>r?(o=n,r=i):i===r&&(o=`${o}, ${n}`)}),e.mostFrequentScore[t]=o}),e}}w(u,"DartService");class P extends HTMLElement{connectedCallback(){S.build(this,he);const e=document.getElementById("numberOfPlayers");P.showInputFieldsForNumberOfPlayers(e.value),e.addEventListener("change",()=>{P.showInputFieldsForNumberOfPlayers(e.value)})}static showInputFieldsForNumberOfPlayers(e){const t=document.getElementById("player2"),s=document.getElementById("player3"),o=document.getElementById("player4"),r=document.getElementById("player5"),n=document.getElementById("player6");e==="1"&&(t.setAttribute("hidden",""),s.setAttribute("hidden",""),o.setAttribute("hidden",""),r.setAttribute("hidden",""),n.setAttribute("hidden","")),e==="2"&&(t.removeAttribute("hidden"),s.setAttribute("hidden",""),o.setAttribute("hidden",""),r.setAttribute("hidden",""),n.setAttribute("hidden","")),e==="3"&&(t.removeAttribute("hidden"),s.removeAttribute("hidden"),o.setAttribute("hidden",""),r.setAttribute("hidden",""),n.setAttribute("hidden","")),e==="4"&&(t.removeAttribute("hidden"),s.removeAttribute("hidden"),o.removeAttribute("hidden"),r.setAttribute("hidden",""),n.setAttribute("hidden","")),e==="5"&&(t.removeAttribute("hidden"),s.removeAttribute("hidden"),o.removeAttribute("hidden"),r.removeAttribute("hidden"),n.setAttribute("hidden","")),e==="6"&&(t.removeAttribute("hidden"),s.removeAttribute("hidden"),o.removeAttribute("hidden"),r.removeAttribute("hidden"),n.removeAttribute("hidden"))}static async createGame(){const t=document.getElementById("numberOfPlayers").value,s=document.getElementById("player1").value,o=document.getElementById("player2").value,r=document.getElementById("player3").value,n=document.getElementById("player4").value,i=document.getElementById("player5").value,l=document.getElementById("player6").value,c=[s];t==="2"&&c.push(o),t==="3"&&(c.push(o),c.push(r)),t==="4"&&(c.push(o),c.push(r),c.push(n)),t==="5"&&(c.push(o),c.push(r),c.push(n),c.push(i)),t==="6"&&(c.push(o),c.push(r),c.push(n),c.push(i),c.push(l)),P.duplicatePlayerNameCheck(c)===!0&&P.generateRandomKey().then(m=>{const b=`501-${m}`,I=u.create(m,c);v.Serialize(b,I),window.location=`?route=501&id=${m}`})}static async generateRandomKey(){const e=new TextEncoder().encode(Math.random()),t=await crypto.subtle.digest("SHA-512",e);return Array.from(new Uint8Array(t)).map(r=>r.toString(16).padStart(2,"0")).join("").substring(0,16)}static duplicatePlayerNameCheck(e){let t=!0;return e.forEach(s=>{e.filter(r=>r===s).length>1&&(t=!1)}),t}}w(P,"ConfigurationComponent");var me='<h3 name="heading" id="next">Next: <span id="nextPlayer"></span></h3> <h1 name="infobox" style="text-align:center;font-size:3em" id="required"></h1> <br> <table role="grid" id="game"> <thead> <tr> <th scope="col"><b>Player</b></th> <td cope="col"><b>Sets</b></td> <td cope="col"><b>Legs</b></td> <td cope="col"><b>Required</b></td> </tr> </thead> <tbody> </tbody> </table> <br> <div name="submit"> <input type="number" value="" min="0" max="180"> <button>Submit</button> </div> <div name="undoclose" class="grid"> <button name="undo">Undo</button> <button name="close">Close Leg</button> </div> <h1>Player Stats</h1> <div id="playerStats"> </div> <br> <button id="download">Download Game</button> <br> <p style="text-align:center"><b id="date"></b></p>';const L=me;class p extends HTMLElement{connectedCallback(){S.build(this,L),p.build(this)}static submitSelector='div[name="submit"]';static undoCloseSelector='div[name="undoclose"]';static build(e){const t=y.getParameter("id"),s=document.getElementById("app");if(t===null){s.innerHTML="";const d=s.appendChild(document.createElement("h1"));throw d.innerHTML="ID IS NOT DEFINED",Error()}const o=`501-${t}`,r=v.Deserialize(o);if(r===void 0){s.innerHTML="";const d=s.appendChild(document.createElement("h1"));throw d.innerHTML="ID IS INVALID",Error()}const n=u.getStatus(r);if(n!==E.legStatus.closed){const d=u.getNextPlayer(r),g=document.getElementById("nextPlayer");g.innerText=d;const x=document.getElementById("required");x.innerText=r.required[d]}if(n===E.legStatus.closed){const d=u.getWinner(r),g=document.getElementById("next");g.innerHTML=`Congratulations, ${d}!`;const x=document.getElementById("required");x.innerHTML="&#x1F3AF;"}const i=document.querySelector("#game tbody"),l=document.querySelector("#playerStats");r.players.forEach(d=>{const g=r.sets[d],x=r.legs[d],J=r.required[d],f=document.createElement("tr"),V=document.createElement("th"),W=document.createElement("td"),K=document.createElement("td"),Y=document.createElement("td");V.innerText=d,W.innerText=g,K.innerText=x,Y.innerText=J,f.append(V,W,K,Y),i.append(f);const N=document.createElement("details"),Q=document.createElement("summary"),h=document.createElement("article"),X=document.createElement("table"),$=X.appendChild(document.createElement("tbody"));Q.innerText=d;const ge=$.appendChild(document.createElement("tr")),fe=$.appendChild(document.createElement("tr")),Ee=$.appendChild(document.createElement("tr"));ge.innerHTML=`<th>Highest Score</th><td class='tdright'>${r.highestScore[d]}</td>`,fe.innerHTML=`<th>Highest Finish</th><td class='tdright'>${r.highestFinish[d]}</td>`,Ee.innerHTML=`<th>Most Frequent Score</th><td class='tdright'>${r.mostFrequentScore[d]}</td>`;const ye=h.appendChild(document.createElement("b"));ye.innerText="Scorings",h.append(document.createElement("br")),h.append(document.createElement("br")),h.append(X);const Z=document.createElement("b");Z.innerText="Averages",h.append(document.createElement("br")),h.append(Z),h.append(document.createElement("br")),h.append(document.createElement("br"));const D=document.createElement("table"),O=D.appendChild(document.createElement("tbody")),Se=O.appendChild(document.createElement("tr")),we=O.appendChild(document.createElement("tr")),Ae=O.appendChild(document.createElement("tr"));Se.innerHTML=`<th>Game Average</th><td class='tdright'>${r.gameAverage[d]}</td>`,we.innerHTML=`<th>Current Leg Average</th><td class='tdright'>${r.legAverage[d]}</td>`,Ae.innerHTML=`<th>Best Leg Average</th><td class='tdright'>${r.bestLegAverage[d]}</td>`,h.append(D);const ve=r.legScores[d];h.append(document.createElement("br"));const xe=h.appendChild(document.createElement("b"));xe.innerText="Current Leg Scores",h.append(document.createElement("br")),h.append(document.createElement("br"));const H=h.appendChild(document.createElement("table")).appendChild(document.createElement("tbody")),_=H.appendChild(document.createElement("tr")),Pe=_.appendChild(document.createElement("th")),ee=_.appendChild(document.createElement("td"));ee.setAttribute("class","tdright"),Pe.innerHTML="<b>Score</b>",ee.innerHTML="<b>Required</b>";const te=H.appendChild(document.createElement("tr")),Ie=te.appendChild(document.createElement("th")),re=te.appendChild(document.createElement("td"));re.setAttribute("class","tdright");let M=501;Ie.innerText="-",re.innerText=M,ve.forEach(B=>{const G=H.appendChild(document.createElement("tr")),j=G.appendChild(document.createElement("th")),T=G.appendChild(document.createElement("td"));M-=B,j.innerText=B,T.innerText=M,T.setAttribute("class","tdright")});const k=u.getScoreDistribution(r,d);if(Object.keys(k).length>0){h.append(document.createElement("br"));const B=h.appendChild(document.createElement("b"));B.innerText="Score Distribution",h.append(document.createElement("br")),h.append(document.createElement("br"));const j=h.appendChild(document.createElement("table")).appendChild(document.createElement("tbody"));Object.keys(k).forEach(T=>{const ne=j.appendChild(document.createElement("tr")),Ne=ne.appendChild(document.createElement("th")),oe=ne.appendChild(document.createElement("td"));oe.setAttribute("class","tdright"),Ne.innerText=T,oe.innerText=k[T]})}N.append(Q),N.append(document.createElement("br")),N.append(document.createElement("br")),N.append(h),l.append(N)});const c=document.querySelector(`${p.submitSelector} input`),a=document.querySelector(`${p.submitSelector} button`),m=document.querySelector(`${p.undoCloseSelector} button[name="undo"]`),b=document.querySelector(`${p.undoCloseSelector} button[name="close"]`);n===E.legStatus.closed?(c.setAttribute("disabled",""),a.setAttribute("disabled","")):(c.addEventListener("keydown",d=>{d.key==="Enter"&&p.submitScore(e)}),a.onclick=()=>{p.submitScore(e)},c.focus()),n===E.legStatus.new?m.setAttribute("disabled",""):m.onclick=()=>{p.undo(e)},n!==E.legStatus.closed?b.setAttribute("disabled",""):b.onclick=()=>{p.closeLeg(e)};const I=document.getElementById("date");I.innerText=r.date;const F=document.getElementById("download");F.onclick=()=>{const d=JSON.stringify(r,null,4),g=document.createElement("a");g.setAttribute("href",`data:text/plain;charset=utf-8,${d}`),g.setAttribute("download",r.dateFileName),g.style.display="none",document.body.appendChild(g),g.click(),document.body.removeChild(g)}}static submitScore(e){const s=`501-${y.getParameter("id")}`;let o=v.Deserialize(s);const r=document.querySelector(`${p.submitSelector} input`),n=Number.parseInt(r.value,10);if(Number.isInteger(n)===!1)throw new Error(`cannot convert input '${r.value}' to an integer`);o=u.submitScore(o,n),v.Serialize(s,o),S.build(e,L),p.build(e)}static undo(e){const s=`501-${y.getParameter("id")}`;let o=v.Deserialize(s);o=u.undoScore(o),v.Serialize(s,o),S.build(e,L),p.build(e)}static closeLeg(e){const s=`501-${y.getParameter("id")}`;let o=v.Deserialize(s);o=u.closeLeg(o),v.Serialize(s,o),S.build(e,L),p.build(e)}}w(p,"DartComponent");const pe=[U,P,p,z],be=["config","501"];y.build(ce,pe,be)})();
