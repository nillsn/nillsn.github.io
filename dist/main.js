(()=>{"use strict";class e{static getActualRoute(){return new URLSearchParams(window.location.search).get("route")}static validate(t){const r=e.getActualRoute();null!==r?!0!==t[r]&&window.location.replace("?route=404"):window.location.replace("?route=index")}}class t{static build(e,r,o){r.innerHTML=o,t.updateForEach(r),t.updateProperty(r),t.updateClickEvents(e,r,o),t.updateStaticClickEvents(e,r,o),t.setFocus()}static use(e,t){customElements.define(t,e)}static useOnRoute(r,o,a){e.getActualRoute()===a&&t.use(r,o)}static updateForEach(e){e.querySelectorAll("[forEach]").forEach((t=>{const r=t.parentNode,o=t.getAttribute("forEach"),a=e[o];void 0!==a&&(a.forEach((e=>{const o=t.cloneNode(!0);o.querySelectorAll("[forEachHere]").forEach((t=>{const r=t.getAttribute("forEachHere");t.innerText=""===r?e:e[r]})),r.append(o)})),t.remove())}))}static updateProperty(e){e.querySelectorAll("[property]").forEach((t=>{const r=t.getAttribute("property"),o=e[r];t.innerText=o}))}static updateClickEvents(e,r,o){r.querySelectorAll("[click]").forEach((a=>{const n=a.getAttribute("click");void 0!==r[n]&&a.addEventListener("click",(()=>{r[n](),t.build(e,r,o)}))}))}static updateStaticClickEvents(e,r,o){r.querySelectorAll("[static]").forEach((a=>{const n=a.getAttribute("static"),s=e[n];void 0!==s&&a.addEventListener("click",(()=>{s(),t.build(e,r,o)}))}))}static setFocus(){const e=document.querySelector("[focus]");null!==e&&e.focus()}}class r extends HTMLElement{connectedCallback(){t.build(r,this,"<pagenotfound-component></pagenotfound-component> <index-component></index-component> <configuration-component></configuration-component> <game-component></game-component>")}}class o extends HTMLElement{connectedCallback(){t.build(o,this,"<h1>#404 - Page Not Found Exception</h1>")}}class a extends HTMLElement{connectedCallback(){t.build(a,this,'<h3>AppSwitch</h3> <button static="openConfig">Create Dart Game</button>')}static openConfig(){window.location="?route=config"}}class n{static throwErrorIfUndefined(e){if(void 0===e)throw new Error("PropertyGuardError: parameter is undefined")}static throwErrorIfNoString(e){if("string"!=typeof e)throw new Error("PropertyGuardError: parameter is not a string")}static throwErrorIfNoArrayOfStrings(e){e.forEach((e=>{try{this.throwErrorIfNoString(e)}catch{throw new Error("PropertyGuardError: parameter is not an array of strings")}}))}static throwErrorIfNoNumber(e){if("number"!=typeof e)throw new Error("PropertyGuardError: parameter is not a number")}static throwErrorIfNoArrayOfNumbers(e){e.forEach((e=>{try{this.throwErrorIfNoNumber(e)}catch{throw new Error("PropertyGuardError: parameter is not an array of numbers")}}))}static throwErrorIfNoBoolean(e){if("boolean"!=typeof e)throw new Error("PropertyGuardError: parameter is not a boolean")}static throwErrorIfNoArrayOfBooleans(e){e.forEach((e=>{try{this.throwErrorIfNoBoolean(e)}catch{throw new Error("PropertyGuardError: parameter is not an array of booleans")}}))}static throwErrorIfNoArray(e){if(!1===Array.isArray(e))throw new Error("PropertyGuardError: parameter is not an array")}static throwErrorIfNoObject(e){if("object"!=typeof e)throw new Error("PropertyGuardError: parameter is not an object")}static throwErrorIfNoArrayOfObjects(e){e.forEach((e=>{try{this.throwErrorIfNoObject(e)}catch{throw new Error("PropertyGuardError: parameter is not an array of objects")}}))}static throwErrorIfItemIsNotInArray(e,t){if(this.throwErrorIfUndefined(e),this.throwErrorIfNoArray(t),!1===t.includes(e))throw new Error("PropertyGuardError: item is not part of the array")}}class s{static create(e,t){n.throwErrorIfNoArrayOfStrings(e),n.throwErrorIfNoNumber(t),n.throwErrorIfItemIsNotInArray(t,[101,170,301,501]);const r={};return e.forEach((e=>{const o={sets:0,legs:0,required:t,throws:[],average:"-",highestScore:"-",highestFinish:"-",currentLegThrows:[]};r[e]=o})),{playerNames:e,playerStats:r,gameMode:t}}static buildPlayerStatsArray(e){s.validate(e);const{playerNames:t,playerStats:r}=e,o=[];return t.forEach((e=>{const t=r[e],a={name:e,sets:t.sets,legs:t.legs,required:t.required,throws:t.throws,average:t.average,highestScore:t.highestScore,highestFinish:t.highestFinish};"-"!==a.average&&(a.average=Number.parseFloat(a.average).toFixed(2)),o.push(a)})),o}static getNextPlayer(e){s.validate(e);let t=0,r=0;e.playerNames.forEach((o=>{const a=e.playerStats[o];t+=a.sets,r+=a.legs}));const o=class{static rotate(e,t,r){const o=JSON.parse(JSON.stringify(e)),a=t+r;for(let e=0;e<a;e+=1)o.push(o.shift());return o}}.rotate(e.playerNames,t,r);let a=o[0],n=e.playerStats[a].currentLegThrows.length;for(let t=1;t<o.length;t+=1){const r=o[t],s=e.playerStats[r].currentLegThrows.length;s<n&&(a=r,n=s)}return a}static submitScore(e,t){if(s.validate(e),n.throwErrorIfNoNumber(t),t<0||t>180)return e;const r=s.getNextPlayer(e),o=e.playerStats[r];if(t>o.required)return e;o.required-=t,o.throws.push(t),o.currentLegThrows.push(t),("-"===o.highestScore||o.highestScore<t)&&(o.highestScore=t);let a=0;if(o.throws.forEach((e=>{a+=e})),o.average=a/o.throws.length,0===o.required){("-"===o.highestFinish||o.highestFinish<t)&&(o.highestFinish=t),o.legs+=1;let r=!1;3===o.legs&&(r=!0,o.sets+=1),e.playerNames.forEach((t=>{const o=e;o.playerStats[t].required=e.gameMode,o.playerStats[t].currentLegThrows=[],r&&(o.playerStats[t].legs=0)}))}return e}static validate(e){n.throwErrorIfUndefined(e),n.throwErrorIfNoObject(e);const{playerNames:t,playerStats:r}=e;n.throwErrorIfNoArrayOfStrings(t),n.throwErrorIfNoObject(r)}}class i extends HTMLElement{connectedCallback(){t.build(i,this,'<h3>Game Configuration</h3> <label for="gameMode"><h4>Game Mode</h4></label> <select id="gameMode" required> <option value="101">101</option> <option value="170">170</option> <option value="301">301</option> <option value="501" selected="selected">501</option> </select> <select id="numberOfPlayers" required> <option value="2" selected="selected">2 Players</option> <option value="3">3 Players</option> <option value="4">4 Players</option> <option value="5">5 Players</option> <option value="6">6 Players</option> </select> <label><h4>Player Names</h4></label> <input id="player1" type="text" placeholder="Player 1" value="Player 1"> <input id="player2" type="text" placeholder="Player 2" value="Player 2"> <input id="player3" type="text" placeholder="Player 3" value="Player 3" hidden> <input id="player4" type="text" placeholder="Player 4" value="Player 4" hidden> <input id="player5" type="text" placeholder="Player 5" value="Player 5" hidden> <input id="player6" type="text" placeholder="Player 6" value="Player 6" hidden> <button static="createGame">Game On</button>');const e=document.getElementById("numberOfPlayers");i.showInputFieldsForNumberOfPlayers(e.value),e.addEventListener("change",(()=>{i.showInputFieldsForNumberOfPlayers(e.value)}))}static showInputFieldsForNumberOfPlayers(e){const t=document.getElementById("player3"),r=document.getElementById("player4"),o=document.getElementById("player5"),a=document.getElementById("player6");"2"===e&&(t.setAttribute("hidden",""),r.setAttribute("hidden",""),o.setAttribute("hidden",""),a.setAttribute("hidden","")),"3"===e&&(t.removeAttribute("hidden"),r.setAttribute("hidden",""),o.setAttribute("hidden",""),a.setAttribute("hidden","")),"4"===e&&(t.removeAttribute("hidden"),r.removeAttribute("hidden"),o.setAttribute("hidden",""),a.setAttribute("hidden","")),"5"===e&&(t.removeAttribute("hidden"),r.removeAttribute("hidden"),o.removeAttribute("hidden"),a.setAttribute("hidden","")),"6"===e&&(t.removeAttribute("hidden"),r.removeAttribute("hidden"),o.removeAttribute("hidden"),a.removeAttribute("hidden"))}static async createGame(){const e=document.getElementById("gameMode").value;let t=501;"101"===e&&(t=101),"170"===e&&(t=170),"301"===e&&(t=301);const r=document.getElementById("numberOfPlayers").value,o=document.getElementById("player1").value,a=document.getElementById("player2").value,n=document.getElementById("player3").value,c=document.getElementById("player4").value,l=document.getElementById("player5").value,h=document.getElementById("player6").value,d=[o,a];if("3"===r&&d.push(n),"4"===r&&(d.push(n),d.push(c)),"5"===r&&(d.push(n),d.push(c),d.push(l)),"6"===r&&(d.push(n),d.push(c),d.push(l),d.push(h)),!0===i.duplicatePlayerNameCheck(d)){const e=s.create(d,t),r=await i.generateRandomKey(),o=JSON.stringify(e);localStorage.setItem(r,o),window.location=`?route=game&id=${r}`}}static async generateRandomKey(){const e=(new TextEncoder).encode(Math.random()),t=await crypto.subtle.digest("SHA-512",e);return Array.from(new Uint8Array(t)).map((e=>e.toString(16).padStart(2,"0"))).join("").substr(0,16)}static duplicatePlayerNameCheck(e){let t=!0;return e.forEach((r=>{e.filter((e=>e===r)).length>1&&(t=!1)})),t}}class c extends HTMLElement{constructor(){super();const e=c.getGameId(),t=localStorage.getItem(e);if(null===t)throw new Error("Game ID is invalid!");this.game=JSON.parse(t),this.updateComponent()}connectedCallback(){t.build(c,this,'<h3>Good Flight, <span property="nextPlayer"></span>!</h3> <table role="grid"> <thead> <tr> <th scope="col">Player</th> <th scope="col">Sets</th> <th scope="col">Legs</th> <th scope="col">Required</th> </tr> </thead> <tbody> <tr forEach="playerStats"> <th scope="row" forEachHere="name"></th> <td forEachHere="sets"></td> <td forEachHere="legs"></td> <td forEachHere="required"></td> </tr> </tbody> </table> <input id="score" type="number" value="" min="0" max="180" focus> <button click="submitScore">Submit</button> <h3>Additional Stats</h3> <table role="grid"> <thead> <tr> <th scope="col">Player</th> <th scope="col">Highest Score</th> <th scope="col">Highest Finish</th> <th scope="col">Average</th> </tr> </thead> <tbody> <tr forEach="playerStats"> <th scope="row" forEachHere="name"></th> <td forEachHere="highestScore"></td> <td forEachHere="highestFinish"></td> <td forEachHere="average"></td> </tr> </tbody> </table>')}static getGameId(){const e=new URLSearchParams(window.location.search).get("id");if(null===e)throw new Error("Game ID is null!");return e}updateComponent(){this.playerStats=s.buildPlayerStatsArray(this.game),this.nextPlayer=s.getNextPlayer(this.game)}submitScore(){const e=document.getElementById("score"),{value:t}=e,r=parseInt(t,10);if(Number.isNaN(r))throw new Error("Invalid score: input ist not a number");if(r<0||r>180)throw new Error(`Invalid score of: ${r}`);this.game=s.submitScore(this.game,r);const o=c.getGameId(),a=JSON.stringify(this.game);localStorage.setItem(o,a),this.updateComponent()}}e.validate({404:!0,index:!0,config:!0,game:!0}),t.use(r,"app-component"),t.useOnRoute(o,"pagenotfound-component","404"),t.useOnRoute(a,"index-component","index"),t.useOnRoute(i,"configuration-component","config"),t.useOnRoute(c,"game-component","game")})();