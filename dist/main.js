(()=>{"use strict";class e{static getActualRoute(){return new URLSearchParams(window.location.search).get("route")}static validate(t){const r=e.getActualRoute();null!==r?!0!==t[r]&&window.location.replace("?route=404"):window.location.replace("?route=index")}}class t{static build(e,r,o){r.innerHTML="",r.insertAdjacentHTML("beforeend",o),t.updateForEach(r),t.updateProperty(r),t.updateClickEvents(e,r,o),t.updateStaticClickEvents(e,r,o)}static use(e,t){customElements.define(t,e)}static useOnRoute(r,o,a){e.getActualRoute()===a&&t.use(r,o)}static updateForEach(e){e.querySelectorAll("[forEach]").forEach((t=>{const r=t.parentNode,o=t.getAttribute("forEach"),a=e[o];void 0!==a&&(a.forEach((e=>{const o=t.cloneNode(!0);o.querySelectorAll("[forEachHere]").forEach((t=>{const r=t.getAttribute("forEachHere");t.innerText=""===r?e:e[r]})),r.append(o)})),t.remove())}))}static updateProperty(e){e.querySelectorAll("[property]").forEach((t=>{const r=t.getAttribute("property"),o=e[r];t.innerText=o}))}static updateClickEvents(e,r,o){r.querySelectorAll("[click]").forEach((a=>{const n=a.getAttribute("click");void 0!==r[n]&&a.addEventListener("click",(()=>{r[n](),t.build(e,r,o)}))}))}static updateStaticClickEvents(e,r,o){r.querySelectorAll("[static]").forEach((a=>{const n=a.getAttribute("static"),s=e[n];void 0!==s&&a.addEventListener("click",(()=>{s(),t.build(e,r,o)}))}))}}class r extends HTMLElement{connectedCallback(){t.build(r,this,'<a style="text-decoration:none" href="?route=index"> <h1>VanillaJS</h1> </a> <pagenotfound-component></pagenotfound-component> <index-component></index-component> <configuration-component></configuration-component> <game-component></game-component>')}}class o extends HTMLElement{connectedCallback(){t.build(o,this,"<h1>#404 - Page Not Found Exception</h1>")}}class a extends HTMLElement{connectedCallback(){t.build(a,this,'<h3>Index</h3> <ul> <li><a href="?route=config">Create 501 Game</a></li> </ul>')}}class n{static throwErrorIfUndefined(e){if(void 0===e)throw new Error("PropertyGuardError: parameter is undefined")}static throwErrorIfNoString(e){if("string"!=typeof e)throw new Error("PropertyGuardError: parameter is not a string")}static throwErrorIfNoArrayOfStrings(e){e.forEach((e=>{try{this.throwErrorIfNoString(e)}catch{throw new Error("PropertyGuardError: parameter is not an array of strings")}}))}static throwErrorIfNoNumber(e){if("number"!=typeof e)throw new Error("PropertyGuardError: parameter is not a number")}static throwErrorIfNoArrayOfNumbers(e){e.forEach((e=>{try{this.throwErrorIfNoNumber(e)}catch{throw new Error("PropertyGuardError: parameter is not an array of numbers")}}))}static throwErrorIfNoBoolean(e){if("boolean"!=typeof e)throw new Error("PropertyGuardError: parameter is not a boolean")}static throwErrorIfNoArrayOfBooleans(e){e.forEach((e=>{try{this.throwErrorIfNoBoolean(e)}catch{throw new Error("PropertyGuardError: parameter is not an array of booleans")}}))}static throwErrorIfNoArray(e){if(!1===Array.isArray(e))throw new Error("PropertyGuardError: parameter is not an array")}static throwErrorIfNoObject(e){if("object"!=typeof e)throw new Error("PropertyGuardError: parameter is not an object")}static throwErrorIfNoArrayOfObjects(e){e.forEach((e=>{try{this.throwErrorIfNoObject(e)}catch{throw new Error("PropertyGuardError: parameter is not an array of objects")}}))}static throwErrorIfItemIsNotInArray(e,t){if(this.throwErrorIfUndefined(e),this.throwErrorIfNoArray(t),!1===t.includes(e))throw new Error("PropertyGuardError: item is not part of the array")}}class s{static create(e){n.throwErrorIfNoArrayOfStrings(e);const t={};return e.forEach((e=>{t[e]={sets:0,legs:0,required:501,throws:[],average:"-",highestScore:"-",highestFinish:"-",currentLegThrows:[]}})),{playerNames:e,playerStats:t}}static buildPlayerStatsArray(e){s.validate(e);const{playerNames:t,playerStats:r}=e,o=[];return t.forEach((e=>{const t=r[e],a={name:e,sets:t.sets,legs:t.legs,required:t.required,throws:t.throws,average:t.average,highestScore:t.highestScore,highestFinish:t.highestFinish};"-"!==a.average&&(a.average=Number.parseFloat(a.average).toFixed(2)),o.push(a)})),o}static getNextPlayer(e){s.validate(e);let t=0,r=0;e.playerNames.forEach((o=>{const a=e.playerStats[o];t+=a.sets,r+=a.legs}));const o=class{static rotate(e,t,r){const o=JSON.parse(JSON.stringify(e)),a=t+r;for(let e=0;e<a;e+=1)o.push(o.shift());return o}}.rotate(e.playerNames,t,r);let a=o[0],n=e.playerStats[a].currentLegThrows.length;for(let t=1;t<o.length;t+=1){const r=o[t],s=e.playerStats[r].currentLegThrows.length;s<n&&(a=r,n=s)}return a}static submitScore(e,t){if(s.validate(e),n.throwErrorIfNoNumber(t),t<0||t>180)return e;const r=s.getNextPlayer(e),o=e.playerStats[r];if(t>o.required)return s.submitScore(e,0);o.required-=t,o.throws.push(t),o.currentLegThrows.push(t),("-"===o.highestScore||o.highestScore<t)&&(o.highestScore=t);let a=0;if(o.throws.forEach((e=>{a+=e})),o.average=a/o.throws.length,0===o.required){("-"===o.highestFinish||o.highestFinish<t)&&(o.highestFinish=t),o.legs+=1;let r=!1;3===o.legs&&(r=!0,o.sets+=1),e.playerNames.forEach((t=>{const o=e;o.playerStats[t].required=501,o.playerStats[t].currentLegThrows=[],r&&(o.playerStats[t].legs=0)}))}return e}static validate(e){n.throwErrorIfUndefined(e),n.throwErrorIfNoObject(e);const{playerNames:t,playerStats:r}=e;n.throwErrorIfNoArrayOfStrings(t),n.throwErrorIfNoObject(r)}}class i extends HTMLElement{connectedCallback(){t.build(i,this,'<h3>Game Configuration</h3> <label for="numberOfPlayers"><h4>Number of players</h4></label> <select id="numberOfPlayers" required> <option value="2" selected="selected">2 Players</option> <option value="3">3 Players</option> <option value="4">4 Players</option> </select> <input id="player1" type="text" placeholder="Player 1" value="Player 1"> <input id="player2" type="text" placeholder="Player 2" value="Player 2"> <input id="player3" type="text" placeholder="Player 3" value="Player 3"> <input id="player4" type="text" placeholder="Player 4" value="Player 4"> <button static="createGame">Game On</button>');const e=document.getElementById("numberOfPlayers");i.showInputFieldsForNumberOfPlayers(e.value),e.addEventListener("change",(()=>{i.showInputFieldsForNumberOfPlayers(e.value)}))}static showInputFieldsForNumberOfPlayers(e){const t=document.getElementById("player3"),r=document.getElementById("player4");"2"===e&&(t.setAttribute("hidden",""),r.setAttribute("hidden","")),"3"===e&&(t.removeAttribute("hidden"),r.setAttribute("hidden","")),"4"===e&&(t.removeAttribute("hidden"),r.removeAttribute("hidden"))}static async createGame(){const e=document.getElementById("numberOfPlayers").value,t=document.getElementById("player1").value,r=document.getElementById("player2").value,o=document.getElementById("player3").value,a=document.getElementById("player4").value,n=[t,r];"3"===e&&n.push(o),"4"===e&&(n.push(o),n.push(a));const c=s.create(n),l=await i.generateRandomKey(),h=JSON.stringify(c);localStorage.setItem(l,h),window.location=`?route=game&id=${l}`}static async generateRandomKey(){const e=(new TextEncoder).encode(Math.random()),t=await crypto.subtle.digest("SHA-512",e);return Array.from(new Uint8Array(t)).map((e=>e.toString(16).padStart(2,"0"))).join("").substr(0,16)}}class c extends HTMLElement{constructor(){super();const e=c.getGameId(),t=localStorage.getItem(e);if(null===t)throw new Error("Game ID is invalid!");this.game=JSON.parse(t),this.updateComponent()}connectedCallback(){t.build(c,this,'<h3>Good Flight!</h3> <table role="grid"> <thead> <tr> <th scope="col">Player</th> <th scope="col">Sets</th> <th scope="col">Legs</th> <th scope="col">Required</th> </tr> </thead> <tbody> <tr forEach="playerStats"> <th scope="row" forEachHere="name"></th> <td forEachHere="sets"></td> <td forEachHere="legs"></td> <td forEachHere="required"></td> </tr> </tbody> </table> <h3>Next: <span property="nextPlayer"></span></h3> <input id="score" type="number" value="" min="0" max="180"> <button click="submitScore">Submit</button> <h3>Additional Stats</h3> <table role="grid"> <thead> <tr> <th scope="col">Player</th> <th scope="col">Highest Score</th> <th scope="col">Highest Finish</th> <th scope="col">Average</th> </tr> </thead> <tbody> <tr forEach="playerStats"> <th scope="row" forEachHere="name"></th> <td forEachHere="highestScore"></td> <td forEachHere="highestFinish"></td> <td forEachHere="average"></td> </tr> </tbody> </table>')}static getGameId(){const e=new URLSearchParams(window.location.search).get("id");if(null===e)throw new Error("Game ID is null!");return e}updateComponent(){this.playerStats=s.buildPlayerStatsArray(this.game),this.nextPlayer=s.getNextPlayer(this.game)}submitScore(){const e=document.getElementById("score"),{value:t}=e,r=parseInt(t,10);if(Number.isNaN(r))throw new Error("Invalid score: input ist not a number");if(r<0||r>180)throw new Error(`Invalid score of: ${r}`);this.game=s.submitScore(this.game,r);const o=c.getGameId(),a=JSON.stringify(this.game);localStorage.setItem(o,a),this.updateComponent()}}e.validate({404:!0,index:!0,config:!0,game:!0}),t.use(r,"app-component"),t.useOnRoute(o,"pagenotfound-component","404"),t.useOnRoute(a,"index-component","index"),t.useOnRoute(i,"configuration-component","config"),t.useOnRoute(c,"game-component","game")})();